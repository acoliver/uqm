# Phase 04: .rmp Parser Fix — TDD (COMPLETED)

## Phase ID
`PLAN-20260224-RES-SWAP.P04`

## Completion Date
2026-02-24

## Summary
Added 22 TDD tests (RED phase) for `parse_type_path()` and `parse_propfile()` stubs.

## Tests Added

### parse_type_path tests (in `rust/src/resource/index.rs`): 9 tests
- `test_parse_type_path_gfxres` — basic GFXRES:path split
- `test_parse_type_path_string` — STRING:value split
- `test_parse_type_path_boolean` — BOOLEAN:value split
- `test_parse_type_path_int32` — INT32:value split
- `test_parse_type_path_color` — COLOR:rgb(...) split
- `test_parse_type_path_3dovid_multi_colon` — split on FIRST colon only (3DOVID with multiple colons)
- `test_parse_type_path_conversation_multi_colon` — CONVERSATION with multiple colon-separated paths
- `test_parse_type_path_no_colon` — no colon returns (None, full_string)
- `test_parse_type_path_empty_path` — "STRING:" returns (Some("STRING"), "")

### parse_propfile tests (in `rust/src/resource/propfile.rs`): 13 tests
- `test_propfile_basic_keyvalue` — basic key=TYPE:path parsing
- `test_propfile_preserves_key_case` — key case preserved (not lowercased)
- `test_propfile_comment_line` — # comment lines skipped
- `test_propfile_inline_comment` — inline # comments stripped from values
- `test_propfile_whitespace_trimming` — leading/trailing whitespace trimmed
- `test_propfile_blank_lines` — blank lines skipped
- `test_propfile_key_without_value` — bare key logged as warning, skipped
- `test_propfile_bare_key_at_eof` — bare key at EOF, handler never called
- `test_propfile_prefix_prepended` — prefix prepended to keys
- `test_propfile_null_prefix` — None prefix means no prefix
- `test_propfile_prefix_length_limit` — prefix+key truncated to 255 chars
- `test_propfile_multiple_entries` — 5 entries parsed in order
- `test_propfile_real_rmp_content` — realistic uqm.rmp-style content (9 entries)

## Verification Results
- `cargo fmt --check`: PASS (our files clean)
- `cargo test --lib --all-features`: 1163 passed, 0 failed, 26 ignored
- All 22 new tests compile and are `#[ignore]` (RED — stubs have `todo!()`)

## Structural Verification
- [x] All listed tests exist
- [x] Tests are in the correct modules (index.rs and propfile.rs)
- [x] Tests compile (ignored, would panic on `todo!()`)
- [x] Plan/requirement markers present (`@plan PLAN-20260224-RES-SWAP.P04`)

## Semantic Verification
- [x] Tests cover TYPE:path splitting (including multi-colon)
- [x] Tests cover case sensitivity (key case preserved)
- [x] Tests cover inline comments
- [x] Tests cover prefix mechanism
- [x] Tests cover edge cases (bare key, no colon, empty value, prefix length limit)
- [x] Tests will FAIL (RED) when run without `--ignore` — proving they test real behavior
