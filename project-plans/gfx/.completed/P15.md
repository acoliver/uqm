# Phase P15: Canvas FFI Bridge — Stub

## Phase ID
`PLAN-20260223-GFX-FULL-PORT.P15`

## Completion
- **Timestamp**: 2026-02-23
- **Status**: [OK] Complete

## Files Created
- `rust/src/graphics/canvas_ffi.rs` — Canvas FFI bridge with SurfaceCanvas handle-based API

## Files Modified
- `rust/src/graphics/mod.rs` — Added `pub mod canvas_ffi;`
- `sc2/src/libs/graphics/sdl/rust_gfx.h` — Added `SurfaceCanvas` opaque type and 11 `rust_canvas_*` declarations

## Exports
Total `#[no_mangle]` exports: **11**

| Export | Purpose |
|--------|---------|
| `rust_canvas_from_surface` | Create SurfaceCanvas handle from SDL_Surface |
| `rust_canvas_destroy` | Free SurfaceCanvas handle |
| `rust_canvas_draw_line` | Draw line (stub) |
| `rust_canvas_draw_rect` | Draw rectangle outline (stub) |
| `rust_canvas_fill_rect` | Fill rectangle (stub) |
| `rust_canvas_copy` | Copy canvas region (stub) |
| `rust_canvas_draw_image` | Blit image data (stub) |
| `rust_canvas_draw_fontchar` | Render font glyph (stub) |
| `rust_canvas_set_scissor` | Set clipping rectangle (stub) |
| `rust_canvas_clear_scissor` | Clear clipping rectangle (stub) |
| `rust_canvas_get_extent` | Query canvas dimensions (functional) |

## Implementation Notes
- `rust_canvas_from_surface` and `rust_canvas_destroy` are **functional** (Box alloc/dealloc)
- `rust_canvas_get_extent` is **functional** (reads cached dimensions)
- All drawing stubs return 0 (success) for valid handle, -1 for null
- All exports use `catch_unwind` for panic safety
- Functions that dereference raw pointers are marked `unsafe extern "C"`
- `SurfaceCanvas` uses `#[repr(C)]` and wraps `*mut SDL_Surface` + Rust `Canvas`

## Verification
```
cargo fmt --all --check     [OK] Pass
cargo clippy (canvas_ffi)   [OK] 0 warnings
cargo test --lib             [OK] 26 canvas_ffi tests pass (1073/1074 total, 1 pre-existing flaky)
cargo build --release        [OK] 11 linkable symbols
Deferred impl detection      [OK] CLEAN (no FIXME/HACK/placeholder)
```

## Test Coverage
- 26 tests covering:
  - Lifecycle: null surface, zero dimensions, null pixels, create+destroy roundtrip, null destroy
  - get_extent: correct dimensions, null handle, null output pointers
  - Drawing stubs: null handle returns -1, valid handle returns 0 (for all 8 operations)
  - Full lifecycle: complete sequence of all operations on a single handle
