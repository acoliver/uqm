# Phase P16: Canvas FFI Bridge — TDD

## Phase ID
`PLAN-20260223-GFX-FULL-PORT.P16`

## Completion
- **Timestamp**: 2026-02-23
- **Status**: [OK] Complete

## Files Modified
- `rust/src/graphics/canvas_ffi.rs` — Added 41 pixel-verifying tests

## Test Coverage
- **41 tests** covering all 7 requirement areas:

### REQ-CANVAS-010: Lifecycle (7 tests)
- `test_canvas_from_null_surface` — null surface → null handle
- `test_canvas_from_valid_surface` — valid surface → non-null handle
- `test_canvas_destroy` — destroy handle, no crash
- `test_canvas_destroy_null` — destroy null, no crash
- `test_canvas_from_zero_dimensions` — zero dims → null handle
- `test_canvas_from_null_pixels` — null pixels → null handle
- `test_get_extent` / `test_get_extent_null_handle` / `test_get_extent_null_outputs`

### REQ-CANVAS-020: Draw Line (5 tests)
- `test_canvas_draw_line_horizontal` — pixel verification along horizontal
- `test_canvas_draw_line_vertical` — pixel verification along vertical
- `test_canvas_draw_line_diagonal` — start/end pixel verification
- `test_canvas_draw_line_clipped` — line partially outside bounds
- `test_canvas_draw_line_null_handle` — null handle returns -1

### REQ-CANVAS-030: Draw Rect / Fill Rect (6 tests)
- `test_canvas_draw_rect_outline` — 4 edges verified, interior empty
- `test_canvas_fill_rect_solid` — all pixels in region filled
- `test_canvas_fill_rect_clipped` — rect beyond bounds, clipped pixels verified
- `test_canvas_fill_rect_zero_size` — zero size, no crash
- `test_canvas_draw_rect_null_handle` / `test_canvas_fill_rect_null_handle`

### REQ-CANVAS-040: Draw Image (4 tests)
- `test_canvas_draw_image_basic` — 2x2 RGBA image pixel verification
- `test_canvas_draw_image_clipped` — image near edge, clipped
- `test_canvas_draw_image_null_data` — null data, no-op
- `test_canvas_draw_image_null_handle` — null handle returns -1

### REQ-CANVAS-050: Draw Fontchar (4 tests)
- `test_canvas_draw_fontchar_opaque` — fully opaque glyph pixel verification
- `test_canvas_draw_fontchar_transparent` — alpha blending arithmetic verification
- `test_canvas_draw_fontchar_clipped` — glyph near edge, clipped
- `test_canvas_draw_fontchar_null_handle` — null handle returns -1

### REQ-CANVAS-060: Scissor (6 tests)
- `test_canvas_scissor_clips_line` — line outside scissor not drawn
- `test_canvas_scissor_clips_fill` — fill clipped to scissor
- `test_canvas_scissor_disable` — disable scissor, full canvas writable
- `test_canvas_scissor_clips_fontchar` — glyph clipped to scissor
- `test_canvas_set_scissor_null_handle` / `test_canvas_clear_scissor_null_handle`

### REQ-CANVAS-070: Canvas Copy (5 tests)
- `test_canvas_copy_basic` — copy region, verify destination pixels
- `test_canvas_copy_with_src_rect` — sub-rect copy, verify 3x3 region
- `test_canvas_copy_clipped` — copy near edge, clipped
- `test_canvas_copy_null_dst` / `test_canvas_copy_null_src`

### Cross-cutting (4 tests)
- `test_color_from_u32_conversion` — RGBA packing verified
- `test_full_lifecycle` — complete sequence of all operations

## Verification
```
cargo fmt --all --check     [OK] Pass
cargo clippy (canvas_ffi)   [OK] 0 errors
cargo test --lib             [OK] 41 canvas_ffi tests pass, 1090 total pass
grep '#[test]' count         [OK] 41 (>= 20 required)
Deferred impl detection      [OK] CLEAN
```
