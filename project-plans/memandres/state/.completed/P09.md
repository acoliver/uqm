# Phase P09: C Redirect — Stub

- **Phase ID**: P09
- **Completed**: 2026-02-24
- **Files modified**:
  - `sc2/config_unix.h` — added `#define USE_RUST_STATE`
  - `sc2/build.vars` — added `-DUSE_RUST_STATE` to CFLAGS/CXXFLAGS and all variable/export lines
  - `sc2/src/uqm/state.c` — added `#include <stdint.h>`, `#ifdef USE_RUST_STATE` block with extern FFI declarations and 7 redirect implementations, `#else` block preserving original C implementations, `#endif`
- **Files NOT created**: No separate `rust_state_ffi.h` — extern declarations kept inline in state.c per task instructions
- **Key design decisions**:
  - `GAME_STATE_FILE` struct and `state_files` static array remain OUTSIDE both `#ifdef` branches (needed for pointer ↔ index translation)
  - `InitPlanetInfo`, `UninitPlanetInfo`, `GetPlanetInfo`, `PutPlanetInfo` remain unguarded (they are callers, not implementations)
  - Redirect functions use `(int)(fp - state_files)` for pointer-to-index translation
  - `DeleteStateFile` passes stateFile index directly (already index-based)
  - `int64_t` used for seek offset cast (requires `<stdint.h>`)
- **Build**: Full build succeeds with USE_RUST_STATE enabled
- **Verification**: All 7 `rust_*_state_file` symbols linked, all 7 C wrapper functions present
