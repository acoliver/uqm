# Phase 03: .rmp Parser Fix â€” Stub

## Phase ID
`PLAN-20260224-RES-SWAP.P03`

## Completion Date
2026-02-24

## Changes Made

### propfile.rs
- Added `parse_propfile()` standalone function stub with `todo!()`
  - Signature: `pub fn parse_propfile(_data: &str, _handler: &mut dyn FnMut(&str, &str), _prefix: Option<&str>)`
  - Accepts data string, callback handler, and optional key prefix
  - Will match C `PropFile_from_string` behavior when implemented
- Marked `PropertyFile::from_string` as `#[deprecated(note = "Use parse_propfile() instead")]`
- Added `@plan` and `@requirement` markers
- Added `#[allow(deprecated)]` to test module (tests still exercise `from_string`)

### index.rs
- Added `resource_type: Option<String>` field to `ResourceEntry`
  - Initialized to `None` in both `new()` and `with_offset()` constructors
- Added `parse_type_path()` standalone function stub with `todo!()`
  - Signature: `pub fn parse_type_path(_value: &str) -> (Option<&str>, &str)`
  - Will split `TYPE:path` values when implemented
- Changed `ResourceIndex::new()` default to `case_sensitive: true` (matches C behavior)
- Updated `test_resource_index_case_sensitivity` test for new default
- Added `@plan` and `@requirement` markers
- Updated module doc to show `TYPE:path` format

### stringbank.rs
- Added `#[allow(deprecated)]` to `load_table_from_string` (calls deprecated `from_string`)

### loader.rs
- Updated `test_exists` test: case-sensitive assertions now expect `false` for wrong-case lookups

### tests.rs
- Added `#[allow(deprecated)]` to `propfile_tests` module

## Verification
- `cargo test --lib --all-features`: 1163 passed, 0 failed
- `cargo clippy`: No new warnings (pre-existing warnings in ffi.rs, index.rs, cache.rs unchanged)

## Structural Checklist
- [x] `propfile.rs` has new `parse_propfile()` function (stub with `todo!()`)
- [x] `index.rs` has `resource_type` field on `ResourceEntry`
- [x] `index.rs` has `parse_type_path()` helper (stub)
- [x] Key case changed to case-sensitive in `ResourceIndex`
- [x] Existing `PropertyFile::from_string` marked deprecated
- [x] Plan/requirement traceability markers present
- [x] All existing tests compile and pass
