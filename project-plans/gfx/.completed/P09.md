# Phase P09: Color Layer — Stub

## Phase ID
`PLAN-20260223-GFX-FULL-PORT.P09`

## Completion
- **Timestamp**: 2026-02-23
- **Status**: Complete

## Files Modified
- `rust/src/graphics/ffi.rs` — `rust_gfx_color` replaced with guarded stub

## Functions Implemented
- `rust_gfx_color(r, g, b, a, rect)` — color layer stub:
  - REQ-CLR-060: uninitialized guard (returns immediately when `get_gfx_state()` is None)
  - REQ-CLR-055: negative rect dimension guard (checks C rect `w < 0 || h < 0` directly)
  - Body: log-once-and-return pattern (no `todo!()` — called every frame)
  - Parameters unaliased (no underscore prefix)
  - `color_stub_logged` field added to `RustGraphicsState`

## Requirements Implemented
- REQ-CLR-060: ColorLayer uninitialized guard
- REQ-CLR-055: ColorLayer negative rect guard

## Tests
- `test_gfx_color_uninitialized_no_panic` — REQ-CLR-060 verification
- `test_gfx_color_negative_rect_no_panic` — REQ-CLR-055 verification
- `test_gfx_color_null_rect_no_panic` — null rect edge case
- All 1034 tests pass, 4 ignored (pre-existing SDL-dependent tests)

## Verification
- `cargo test --lib --all-features`: 1034 passed, 0 failed, 4 ignored

## Structural Verification Checklist
- [x] `rust_gfx_color` has guard clauses
- [x] Parameters no longer prefixed with `_`
- [x] No `todo!()` — uses log-once-and-return pattern (safe for per-frame calls)
- [x] Compiles without errors

## Semantic Verification Checklist
- [x] Guard clauses return early for uninitialized and negative rect
- [x] No fake behavior (stub logs honestly)
- [x] Existing tests still pass

## Notes
- Negative rect guard checks the raw C `SDL_Rect` directly rather than using `convert_c_rect`,
  because `convert_c_rect` clamps negatives to 0 and `sdl2::rect::Rect` then clamps 0→1,
  making it impossible to distinguish "originally negative" from "originally zero/one".
- Log-once pattern uses `state.color_stub_logged` field (same pattern as `hq2x_logged`/`xbrz_logged`).
- Full color layer implementation (blend + fill) deferred to a future phase.
