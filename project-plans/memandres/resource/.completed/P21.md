# Phase Completion: P21
## Phase ID: PLAN-20260224-RES-SWAP.P21
## Timestamp: 2026-02-24
## Status: PASS

## Summary
Added `#ifndef USE_RUST_RESOURCE` / `#endif` guards to 5 C resource files so that
when `USE_RUST_RESOURCE` is defined, C function implementations are compiled out
and Rust provides them via ffi_bridge.rs.

## Files Modified

### C files guarded (5):
1. `sc2/src/libs/resource/resinit.c` — ALL function bodies guarded (line 34–655)
2. `sc2/src/libs/resource/getres.c` — ALL functions + `_cur_resfile_name` guarded (line 26–261)
3. `sc2/src/libs/resource/propfile.c` — ALL functions guarded (line 26–133)
4. `sc2/src/libs/resource/loadres.c` — ALL functions guarded (line 23–57)
5. `sc2/src/libs/resource/filecntl.c` — ALL functions guarded (line 30–148)

### C files NOT guarded (verified):
- `sc2/src/libs/resource/stringbank.c` — remains in C
- `sc2/src/libs/resource/direct.c` — remains in C

### Rust fix:
- `rust/src/resource/ffi_bridge.rs` — Fixed `uio_getc`/`uio_putc` extern declarations
  to `uio_fgetc`/`uio_fputc` (the actual function names; `uio_getc`/`uio_putc` are
  C macros that don't exist as linkable symbols)

### rust_resource.c:
- Already wrapped in `#ifdef USE_RUST_RESOURCE` — no changes needed
- Old sidecar functions (`RustResourceInit`, etc.) have unique names, no conflicts

## Verification
- Build with `USE_RUST_RESOURCE=1`: [OK] Clean (no errors, no undefined/duplicate symbols)
- Rust unit tests: [OK] 280 resource tests passed
- No symbol conflicts between Rust exports and C guards

## Structural Checklist
- [x] resinit.c fully guarded
- [x] getres.c fully guarded
- [x] propfile.c fully guarded
- [x] loadres.c fully guarded
- [x] filecntl.c fully guarded
- [x] stringbank.c NOT guarded
- [x] direct.c NOT guarded
- [x] Build succeeds with USE_RUST_RESOURCE=1
